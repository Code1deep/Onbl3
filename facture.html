<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Facture - Onbl3 Multiservices</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f9f9f9;
      color: #333;
    }
    .facture-container {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
      max-width: 850px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .logo {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo img {
      max-width: 120px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 12px;
      text-align: center;
    }
    th {
      background: #2c3e50;
      color: #fff;
    }
    .total {
      text-align: right;
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
    }
    .info {
      margin-top: 25px;
      font-size: 14px;
      line-height: 1.6;
    }
    .social-icons {
      margin-top: 20px;
      text-align: center;
    }
    .social-icons a {
      margin: 0 10px;
      font-size: 22px;
      color: #2c3e50;
      text-decoration: none;
      transition: color 0.3s;
    }
    .social-icons a:hover {
      color: #27ae60;
    }
    .actions {
      margin-top: 25px;
      text-align: center;
    }
    .actions button {
      padding: 10px 18px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }
    .btn-pdf {
      background: #27ae60;
      color: #fff;
    }
    .btn-pdf:hover {
      background: #219150;
    }
  </style>
</head>
<body>
  <div class="facture-container" id="facture">
    <div class="logo">
      <img src="assets/logo.png" alt="Logo">
    </div>
    <h1>Facture</h1>
    <p><strong>Numéro de commande :</strong> <span id="order-id"></span></p>
    <p><strong>Date :</strong> <span id="order-date"></span></p>

    <table id="facture-table">
      <thead>
        <tr>
          <th>Article</th>
          <th>Quantité</th>
          <th>Prix unitaire</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <!-- Les lignes seront injectées ici par JS -->
      </tbody>
    </table>

    <div class="total">
      Total : <span id="facture-total">0.00</span> $
    </div>

    <div class="info">
      <p><i class="fa-solid fa-circle-info"></i> Instructions de paiement :</p>
      <ul>
        <li>Paiement en ligne disponible (Visa, Mastercard, Débit).</li>
        <li>En cas d’indisponibilité de paiement en ligne, veuillez confirmer au <strong>514 123 4567</strong>.</li>
        <li>Livraison gratuite pour toute commande supérieure à 20$.</li>
      </ul>
    </div>

    <div class="actions">
      <button class="btn-pdf" onclick="downloadPDF()"><i class="fa-solid fa-file-pdf"></i> Télécharger en PDF</button>
    </div>

    <div class="social-icons">
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-whatsapp"></i></a>
    </div>
  </div>

  <!-- Librairie jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Données simulées du panier (normalement récupérées depuis cart.js / localStorage)
    const cart = JSON.parse(localStorage.getItem("cart")) || [
      { name: "Pommes", qty: 3, price: 2.5 },
      { name: "Bananes", qty: 2, price: 1.8 }
    ];

    // Numéro de commande unique
    const orderId = "CMD-" + Date.now();
    document.getElementById("order-id").textContent = orderId;

    // Date commande
    const today = new Date().toLocaleDateString("fr-CA", { year: 'numeric', month: 'long', day: 'numeric' });
    document.getElementById("order-date").textContent = today;

    // Injecter le tableau
    let total = 0;
    const tbody = document.querySelector("#facture-table tbody");
    cart.forEach(item => {
      const row = document.createElement("tr");
      const itemTotal = (item.qty * item.price).toFixed(2);
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.qty}</td>
        <td>${item.price.toFixed(2)} $</td>
        <td>${itemTotal} $</td>
      `;
      tbody.appendChild(row);
      total += parseFloat(itemTotal);
    });
    document.getElementById("facture-total").textContent = total.toFixed(2);

    // Génération PDF avec jsPDF
    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text("Facture - Onbl3 Multiservices", 20, 20);

      doc.setFontSize(12);
      doc.text(`Numéro de commande : ${orderId}`, 20, 35);
      doc.text(`Date : ${today}`, 20, 45);

      // Tableau articles
      let startY = 60;
      doc.autoTable({
        startY,
        head: [["Article", "Quantité", "Prix unitaire", "Total"]],
        body: cart.map(item => [item.name, item.qty, item.price.toFixed(2) + " $", (item.qty * item.price).toFixed(2) + " $"]),
      });

      // Total
      doc.text(`Total : ${total.toFixed(2)} $`, 150, doc.lastAutoTable.finalY + 15);

      // Instructions paiement
      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
      doc.text("Instructions de paiement :", 20, doc.lastAutoTable.finalY + 35);
      doc.text("- Paiement en ligne (Visa, Mastercard, Débit).", 25, doc.lastAutoTable.finalY + 45);
      doc.text("- Confirmation au 514 123 4567 si pas de paiement en ligne.", 25, doc.lastAutoTable.finalY + 55);
      doc.text("- Livraison gratuite > 20$.", 25, doc.lastAutoTable.finalY + 65);

      // Sauvegarde
      doc.save(`facture_${orderId}.pdf`);
    }
  </script>

  <!-- Plugin jsPDF AutoTable pour le tableau -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</body>
</html>
